<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2017/8/16
 * Time: 20:12
 */

namespace app\wap\controller;


class Sign extends MobileMall
{
    public function _initialize()
    {

        parent::_initialize(); // TODO: Change the autogenerated stub

    }

    /**
     * @desc 获取当天的打卡记录
     * @author langzhiyao
     * @time 2019/8/5 16:13
     */
    public function get_sign(){
        $s_id = trim($_POST['s_id']);
        $startTime = trim($_POST['startTime']);
        $endTime = trim($_POST['endTime']);
        //获取该学生卡号
        $student_info = db('student')->where(array('s_id'=>$s_id))->field('access_card')->find();
        $number = $student_info['access_card'];
        if(empty($number)){
            exit(json_encode(array('code'=>1,'codemsg'=>'该学生未绑定门禁卡')));
        }
        //通过接口获取打卡记录
        $url='http://wkids.touchit.com.cn/attend/list?number='.$number.'&startTime='.$startTime.'&endTime='.$endTime.'&start=0&count=10';
        $html = file_get_contents($url);
        exit($html);
    }

}